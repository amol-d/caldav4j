#summary Building for Android
#labels android,mobile

= Introduction =


Sudheer used caldav4j to write a caldav client for Android. To use that client, which is based on default Android package, you have to follow these steps:
 # checkout android sources v 2.2
 # build android from scratch and check that everything is ok
 # replace the Calendar android sources with the one provided by Sudheer
 # build again
 # get the Calendar.apk
 # install it on your emulator

= Details =

 == Prepare your environment: Java, git, repo ==
 # java 1,5 for froyo (aka android 2.2)
 * sudo add-apt-repository "deb http://archive.ubuntu.com/ubuntu dapper main multiverse"
 * sudo add-apt-repository "deb http://archive.ubuntu.com/ubuntu dapper-updates main multiverse"
 * sudo apt-get update
 * sudo apt-get install sun-java5-jdk
 * sudo update-java-alternatives -s java-1.5.0-sun 
 # git & g++
 * sudo apt-get install git-core gnupg flex bison gperf build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev ia32-libs x11proto-core-dev libx11-dev lib32readline5-dev lib32z-dev
 # repo
 * curl http://android.git.kernel.org/repo > ~/bin/repo
 * chmod a+x ~/bin/repo


 == Get android sources ==
 # mkdir -p ~/droid/
 # cd ~/droid/
 # repo init -u git://android.git.kernel.org/platform/manifest.git  -b froyo-plus-aosp
 # repo sync

 == Build ==
Building requires about 10Gb disk space and an hour on my Core2Duo laptop

'''For 32bit users: after getting android sources, you need to apply this patch to build on 32 bit arch.

http://android-platform.googlegroups.com/attach/5e699c57ad5cf04b/for-32-bit-compilation.patch?view=1&part=2
'''


 
To build the android emulator you must run make sdk too, not just make!
 * source build/envsetup.sh
 * lunch 1
 * make 
 * make sdk

 == Run the vanilla emulator ==
Now you'll find the android sdk emulator in your path. Then run the emulator:
 # cd ~/droid/out/host/linux-x86/sdk/android-sdk_eng.rpolli_linux-x86/
 # tools/android

Create a new device and play with your new toy

 == Replace Calendar app with our one ==
Now download the Calendar.apk from this site and replace the calendar app
 # wget http://caldav4j.googlecode.com/svn/android/bin/Calendar.apk -O /tmp/Calendar.apk
 # ./platform-tools/adb install -r /tmp/Calendar.apk

Njoy ;)


= Troubleshooting and infos =

 == Install the Calendar.apk on your emulator ==
 see http://openhandsetmagazine.com/2008/01/tips-how-to-install-apk-files-on-android-emulator/